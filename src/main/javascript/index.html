<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset = "UTF-8">
    <meta name = "viewport" content = "width=device-width, initial-scale=1.0">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js"></script>
    <link rel = "stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <title>KLM Report</title>
</head>
<body >
    <div class = "container">
        <canvas id = "firstChart"></canvas>

    </div>
    <script >
        const xLabels = [];
        const yLabels = [];

        createChart();
        
        async function createChart(){
            await getData();
                var ctx = document.getElementById('firstChart').getContext('2d');             
                var chart = new Chart(ctx, {
                    // The type of chart we want to create
                    type: 'bar',
                    // The data for our dataset
                    data: {
                        labels: xLabels,
                        datasets: [{
                            label: 'Information on the total time for each operator',
                            fontFamily:'Roboto',
                            backgroundColor: 'rgb(0, 0, 0)',
                            borderColor: 'rgb(0, 0, 0)',
                            data: yLabels
                        }]
                    },

                    // Configuration options go here
                    options: {
                        title: {
                            display: true,
                            fontFamily:'Roboto',
                            text: ['Estimated total time per operator'],
                            fontSize: 16,                          
                        },
                        scales: {
                            yAxes: [{
                                scaleLabel:{
                                    position: 'bottom',
                                    display: true,
                                    labelString: 'Time'
                                },
                            ticks: {
                                beginAtZero: true,
                                steps: 10,
                                stepValue: 6,
                                max: 100 //max value for the chart is 60
                                }
                            }
                        ]
                        }           
                    }
                });

            }
        

        async function getData(){

           await fetch('DataToCharts.csv')
            .then(response => response.text())
            .then(text => { console.log(text)
                var csvArray = text.split('\n').slice(1)
                console.log('csvArray ' + csvArray)
                csvArray.forEach( row => {
                 const columns = row.split(';')
                 var klmOperator = columns[0]
                 if(klmOperator == 'K'){
                     klmOperator = ['Key Press', '(K)']
                 }else if (klmOperator == 'M'){
                    klmOperator = ['Mental','(M)']
                 }else if (klmOperator == 'H'){
                    klmOperator = ['Switch (M-K)','(H)']
                 }else if (klmOperator == 'B'){
                    klmOperator = ['Mouse click','(B)']
                 }else if (klmOperator == 'P'){
                    klmOperator = ['Mouse Point','(P)']
                 }
                 xLabels.push(klmOperator)
                 const times = columns[1]
                 yLabels.push(times)
                 console.log('operators ' + klmOperator, 'times ' + times)
             });
            });

            // const response = fetch ('DataToCharts.csv');
            // const data = response.text;
            // console.log(data);
            // const table = path.split('\n').slice(0);
            // table.forEach( row => {
            //     const columns = row.split(',');
            //     const klmOperator = columns[0];
            //     xLabels.push(klmOperator);
            //     const times = columns[1];
            //     console.log(klmOperator,times);
            // });
        }
   

    </script>
</body>
</html>